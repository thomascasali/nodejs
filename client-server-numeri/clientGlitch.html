<!DOCTYPE html>
<html>
<head>
  <script>
    var ws = new WebSocket("wss://casali-server-numeri.glitch.me");
        
    ws.onmessage = function (msg) {
        console.log("ricevuta " + typeof(msg.data) +": ");
        console.log(msg.data);
        console.log(isJsonString(msg.data));
        if (typeof(msg.data)=="string") {
            //document.getElementById("server-response").innerHTML = msg.data;
        }
        if (isJsonString(msg.data)) {
            console.log("elaboro oggetto JSON");
            var obj = JSON.parse(msg.data);
            if (obj.tipo=="messaggio"){
                document.getElementById("server-msg").innerHTML = obj.valore;
            }
            else if (obj.tipo=="risultato"){
                document.getElementById("server-result").innerHTML = obj.valore;
            }
            else {
                elencoClient="Client connessi:<br>";
                obj.forEach(element => {
                    elencoClient+=element.address + ":<span style='color:blue'>" + element.port+"</span><br>";
                });
                document.getElementById("elenco-client").innerHTML = elencoClient;
            }
        }
        else {
            console.log(msg.data);
            //document.getElementById("server-response").innerHTML = msg.data;
        }
    };
        
    function sendMessage() {
        var message = document.getElementById("client-message").value;
        let obj = JSON.stringify({tipo: 'dato' , valore: '' + message + ''});
        console.log(obj);
        ws.send(obj);
    }
    function sendMode(mode) {
        let obj = JSON.stringify({ tipo: 'operazione' , comando: '' + mode + '' });
        console.log(obj);
        ws.send(obj);
    }

    function isJsonString(str) {
        try {
            JSON.parse(str);
        } catch (e) {
            return false;
        }
        return true;
    }
  </script>
</head>
<body>
    <div id="container">
        <div id="left-column" style="float: left;">
            <div>
                <button type="button" onclick="sendMode('moltiplica')">Moltiplica</button>
                <button type="button" onclick="sendMode('raddoppia')">Raddoppia</button>
                <button type="button" onclick="sendMode('fattoriale')">Fattoriale</button>
                <br/>
                <input type="text" id="client-message" placeholder="Scrivi qui il numero da elaborare">
                <button onclick="sendMessage()">Invia</button>
            </div>
            <div id="server-msg"></div>
            <div id="server-result"></div>
        </div>
        <div id="elenco-client" style="background-color: bisque;float: right;">
            <!-- questo DIV contiene l'elenco dei client connessi -->
        </div>
    </div>
</body>
</html>